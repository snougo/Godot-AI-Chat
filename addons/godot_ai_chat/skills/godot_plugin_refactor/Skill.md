---
name: godot-plugin-refactoring
description: 优化并重构 Godot 插件代码架构，以提升可维护性和性能
---

# Godot Plugin Refactor

## 概览
分析并重构 Godot 插件代码，以改进架构、可维护性、性能，并确保遵循 Godot 最佳实践。

## 触发条件
当用户请求 Godot 插件代码优化、重构或架构改进时。

## 指令
1. **分析当前结构**
   - 检查 `plugin.cfg` 配置文件
   - 审查主插件脚本结构
   - 识别代码组织问题
   - 检查 Godot API 的使用模式

2. **架构评估**
   - 评估单例 (Singleton) 使用和依赖注入
   - 检查场景管理是否恰当
   - 审查信号/回调 (Signal/Callback) 模式
   - 评估资源管理（`preload` 与 `load` 的使用）

3. **代码质量审查**
   - 识别代码重复
   - 检查错误处理是否恰当
   - 审查内存管理模式
   - 评估性能瓶颈

4. **重构建议**
   - 建议模块化组件架构
   - 推荐设计模式（观察者模式、工厂模式等）
   - 提议合理的类继承体系
   - 优化节点树结构

5. **实施**
   - 重构代码并清晰分离关注点 (Separation of Concerns)
   - 实现恰当的初始化和清理流程 (Initialization/Cleanup)
   - 添加详尽的错误处理
   - 创建可重用的工具类
   - 遵循 GDScript 风格指南

6. **文档与测试**
   - 添加行内注释文档
   - 建议测试策略

## 示例
